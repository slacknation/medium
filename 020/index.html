<!DOCTYPE html>
<html lang="en-us">

<head>
    <meta charset="UTF-8">
    <title>Charts and Data</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="../css/normalize.css" media="screen">
    <link rel="stylesheet" type="text/css" href="../css/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="../css/github-light.css" media="screen">
    <link rel="stylesheet" type="text/css" href="../css/tablesaw.bare.css" media="screen">
</head>

<body>
    <section class="page-header">
        <h1 class="project-name">(function(){})();</h1>
        <h2 class="project-tagline">Blockchain, make me rich and I care not what you can be used for.</h2>
        <a href="https://github.com/slacknation/medium/tree/master/020" class="btn">View on GitHub</a>
    </section>
    <section class="main-content">
        <h3><a id="welcome-to-github-pages" class="anchor" href="#welcome-to-github-pages" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span>
        </a>20. EOS ICO</h3>
        <div>ico address: <span style="color:#159957;font-size:20px;" id="address">...</span></div>
        <div>current block: <span style="color:#159957;font-size:20px;" id="block">...</span></div>
        <br />
        <table id="table1" class="tablesaw" data-tablesaw-mode="stack" data-tablesaw-sortable data-tablesaw-sortable-switch data-tablesaw-minimap data-tablesaw-mode-switch>
            <thead>
                <tr>
                  <th scope="col" data-tablesaw-sortable-col data-tablesaw-sortable-default-col data-tablesaw-priority="1">day</th>
                    <th scope="col" data-tablesaw-sortable-col data-tablesaw-priority="1">eos</th>
                    <th scope="col" data-tablesaw-sortable-col data-tablesaw-priority="1">eth</th>
                    <th scope="col" data-tablesaw-sortable-col data-tablesaw-priority="1">eos/eth</th>
                    <th scope="col" data-tablesaw-sortable-col data-tablesaw-priority="1">hours left</th>
                </tr>
            </thead>
            <tbody id="tbody1">
            </tbody>
        </table>
        <br />
        <div>*data from infura.io</div>
        <footer class="site-footer">
            <span class="site-footer-owner">Maintained by <a href="https://github.com/slacknation/medium">slacknation</a> at gmail.com</span>
            <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
        </footer>
    </section>
    <script src="../js/jquery.min.js"></script>
    <script src="../js/web3.min.js"></script>
    <script src="../js/tablesaw.js"></script>
    <script src="../js/tablesaw-init.js"></script>
    <script>
          $(document).ready(function() {
            var color = ['#00A388', '#E74C3C', '#3498DB', '#FF851B'];
            var abi = [{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"dailyTotals","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"}];
            var web3 = new Web3(new Web3.providers.HttpProvider('https://mainnet.infura.io/'));

            var MyContract = web3.eth.contract(abi);
            var eos = '0xd0a6E6C54DbC68Db5db3A091B171A77407Ff7ccf';
            var eosInstance = MyContract.at(eos);
            var start = 1498914000;
            var current = parseInt((Date.now()-start*1000)/1000/60/60/23 + 1);
            $('#address').html(eos);
            var td = document.createElement('td');
            var tr = document.createElement('tr');
            for (var i = 0; i < 5; i++) {
               tr.appendChild(td.cloneNode(true));
            }
            if (current > 350) {
                current = 350;
            }
            for (var i = 0; i < 5; i++) {
               $('#tbody1').append(tr.cloneNode(true));
            }
            var input = [];
            for (var i = current-3; i < current+2; i++) {
                if (i > 350) {
                  input.push('...');
                  input.push('...');
                  input.push('...');
                  input.push('...');
                  input.push('...');
                } else {
                  input.push(i);
                  if (i === 0) {
                    input.push(web3.toBigNumber(200000000).toFormat(0));
                  } else {
                    input.push(web3.toBigNumber(2000000).toFormat(0));
                  }
                  input.push('...');
                  input.push('...');
                  if (i === 0) {
                    input.push('0');
                  } else {
                    var left = ((start + i * 60 * 60 * 23) * 1000 - Date.now()) / 1000 / 60 / 60;
                    if (left > 0) {
                      input.push(web3.toBigNumber(left).toFormat(2));
                    } else {
                      input.push('0');
                    }
                  }
                }
            }
            var k = 0;
            $('#tbody1 td').each(function() {
                $(this).html(input[k]);
                k++;
            });
            for (var i = 0; i < document.getElementsByTagName('td').length; i++) {
                $(document.getElementsByTagName('td')[i]).css('text-align', 'right');
            }
            function firstSync() {
                web3.eth.getBlockNumber(function(error, data) {
                    if (!error) {
                        $('#block').html(web3.toBigNumber(data).toFormat(0));
                        blink('#block');
                    }
                });
                for (var i = current-3; i < current+2; i++) {
                  if (i<351) {
                    (function(i) {
                          eosInstance.dailyTotals.call(i, function(error, data) {
                            if (!error) {
                              document.getElementsByTagName('td')[(i-current+3)*5 + 2].innerHTML = web3.toBigNumber(web3.fromWei(data, 'ether')).toFormat(2);
                              if (i === 0) {
                                document.getElementsByTagName('td')[(i-current+3)*5 + 3].innerHTML = web3.toBigNumber(web3.fromWei(data, 'ether')).dividedBy(200000000).toFormat(6);
                              } else {
                                document.getElementsByTagName('td')[(i-current+3)*5 + 3].innerHTML = web3.toBigNumber(web3.fromWei(data, 'ether')).dividedBy(2000000).toFormat(6);
                              }
                            }
                          });
                    }(i));
                  }
                }
            }
            function getSync() {
                if (current+1.01 < ((Date.now()-start*1000)/1000/60/60/23 + 1)) {
                  location.reload();
                }
                web3.eth.getBlockNumber(function(error, data) {
                    if (!error) {
                        $('#block').html(web3.toBigNumber(data).toFormat(0));
                        blink('#block');
                    }
                });
                if (current<351) {
                  eosInstance.dailyTotals.call(current, function(error, data) {
                    if (!error) {
                      document.getElementsByTagName('td')[3*5 + 2].innerHTML = web3.toBigNumber(web3.fromWei(data, 'ether')).toFormat(2);
                      if (i === 0) {
                        document.getElementsByTagName('td')[3*5 + 3].innerHTML = web3.toBigNumber(web3.fromWei(data, 'ether')).dividedBy(200000000).toFormat(6);
                      } else {
                        document.getElementsByTagName('td')[3*5 + 3].innerHTML = web3.toBigNumber(web3.fromWei(data, 'ether')).dividedBy(2000000).toFormat(6);
                      }
                      blink(document.getElementsByTagName('td')[3*5 + 2]);
                      blink(document.getElementsByTagName('td')[3*5 + 3]);
                    }
                  });
                }
                for (var i = current-3; i < current+2; i++) {
                  if (i<351) {
                    var left = ((start + i * 60 * 60 * 23) * 1000 - Date.now()) / 1000 / 60 / 60;
                    if (left > 0) {
                      document.getElementsByTagName('td')[(i-current+3)*5 + 4].innerHTML = web3.toBigNumber(left).toFormat(2);
                    } else {
                      document.getElementsByTagName('td')[(i-current+3)*5 + 4].innerHTML = '0';
                    }
                    blink(document.getElementsByTagName('td')[(i-current+3)*5 + 4]);
                  }
                }
            }
            firstSync();
            setInterval(function() {
                getSync();
            }, 30 * 1000);
            function blink(id) {
                $(id).css('background-color', '#159957');
                setTimeout(function () {
                    $(id).css('background-color', 'white');
                }, 200);
            }
        });

    </script>
    <script>
        (function(i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r;
            i[r] = i[r] || function() {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
            a = s.createElement(o),
                m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m)
        })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
        ga('create', 'UA-73445041-1', 'auto');
        ga('send', 'pageview');

    </script>
</body>

</html>
