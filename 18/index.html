<!DOCTYPE html>
<html lang="en-us">

<head>
    <meta charset="UTF-8">
    <title>Charts and Data</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="../css/normalize.css" media="screen">
    <link rel="stylesheet" type="text/css" href="../css/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="../css/github-light.css" media="screen">
    <script src="../js/jquery.min.js"></script>
    <script src="../js/web3.min.js"></script>
    <script src="../js/countdown.min.js"></script>
    <script>
        var color = ['#00A388', '#E74C3C', '#3498DB', '#FF851B'];
        var abi = [{"constant":true,"inputs":[],"name":"destEthDevs","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"endBlock","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"maxSGTSupply","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"totalGuaranteedCollected","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"totalNormalCollected","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"maxCallFrequency","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"sntController","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"failSafeLimit","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"exchangeRate","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"maxGasPrice","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"finalizedBlock","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"startBlock","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"","type":"address"},{"name":"","type":"address"},{"name":"","type":"uint256"}],"name":"onTransfer","outputs":[{"name":"","type":"bool"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"pauseContribution","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"finalize","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"maxGuaranteedLimit","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"lastCallBlock","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"dynamicCeiling","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"destTokensDevs","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"paused","outputs":[{"name":"","type":"bool"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"guaranteedBuyersBought","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"acceptOwnership","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"tokensIssued","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_snt","type":"address"},{"name":"_sntController","type":"address"},{"name":"_startBlock","type":"uint256"},{"name":"_endBlock","type":"uint256"},{"name":"_dynamicCeiling","type":"address"},{"name":"_destEthDevs","type":"address"},{"name":"_destTokensReserve","type":"address"},{"name":"_destTokensSgt","type":"address"},{"name":"_destTokensDevs","type":"address"},{"name":"_sgt","type":"address"},{"name":"_maxSGTSupply","type":"uint256"}],"name":"initialize","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"owner","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"SGT","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"guaranteedBuyersLimit","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"destTokensSgt","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_newOwner","type":"address"}],"name":"changeOwner","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"resumeContribution","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"SNT","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_th","type":"address"},{"name":"_limit","type":"uint256"}],"name":"setGuaranteedAddress","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"newOwner","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"destTokensReserve","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"","type":"address"},{"name":"","type":"address"},{"name":"","type":"uint256"}],"name":"onApprove","outputs":[{"name":"","type":"bool"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_token","type":"address"}],"name":"claimTokens","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"totalCollected","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_th","type":"address"}],"name":"proxyPayment","outputs":[{"name":"","type":"bool"}],"payable":true,"type":"function"},{"constant":true,"inputs":[],"name":"finalizedTime","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"inputs":[],"payable":false,"type":"constructor"},{"payable":true,"type":"fallback"},{"anonymous":false,"inputs":[{"indexed":true,"name":"_token","type":"address"},{"indexed":true,"name":"_controller","type":"address"},{"indexed":false,"name":"_amount","type":"uint256"}],"name":"ClaimedTokens","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"_th","type":"address"},{"indexed":false,"name":"_amount","type":"uint256"},{"indexed":false,"name":"_tokens","type":"uint256"},{"indexed":false,"name":"_guaranteed","type":"bool"}],"name":"NewSale","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"_th","type":"address"},{"indexed":false,"name":"_limit","type":"uint256"}],"name":"GuaranteedAddress","type":"event"},{"anonymous":false,"inputs":[],"name":"Finalized","type":"event"}];
        var abiC = [{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"curves","outputs":[{"name":"hash","type":"bytes32"},{"name":"limit","type":"uint256"},{"name":"slopeFactor","type":"uint256"},{"name":"collectMinimum","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"currentIndex","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"nCurves","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"allRevealed","outputs":[{"name":"","type":"bool"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"contribution","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_curveHashes","type":"bytes32[]"}],"name":"setHiddenCurves","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_limits","type":"uint256[]"},{"name":"_slopeFactors","type":"uint256[]"},{"name":"_collectMinimums","type":"uint256[]"},{"name":"_lasts","type":"bool[]"},{"name":"_salts","type":"bytes32[]"}],"name":"revealMulti","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_limit","type":"uint256"},{"name":"_slopeFactor","type":"uint256"},{"name":"_collectMinimum","type":"uint256"},{"name":"_last","type":"bool"},{"name":"_salt","type":"bytes32"}],"name":"revealCurve","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"revealedCurves","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"acceptOwnership","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"_limit","type":"uint256"},{"name":"_slopeFactor","type":"uint256"},{"name":"_collectMinimum","type":"uint256"},{"name":"_last","type":"bool"},{"name":"_salt","type":"bytes32"}],"name":"calculateHash","outputs":[{"name":"","type":"bytes32"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"collected","type":"uint256"}],"name":"toCollect","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"owner","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_newOwner","type":"address"}],"name":"changeOwner","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_index","type":"uint256"}],"name":"moveTo","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"newOwner","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"inputs":[{"name":"_owner","type":"address"},{"name":"_contribution","type":"address"}],"payable":false,"type":"constructor"}];
        var abiR = [{"constant":false,"inputs":[{"name":"a","type":"uint256"},{"name":"b","type":"uint256"}],"name":"update","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"txs","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"eth","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"}];

        var web3 = new Web3(new Web3.providers.HttpProvider('https://mainnet.infura.io/'));
        var web4 = new Web3(new Web3.providers.HttpProvider('https://rinkeby.infura.io/'));

        document.addEventListener('DOMContentLoaded', function(event) {
            var MyContract = web3.eth.contract(abi);
            var contractInstance = MyContract.at('0x55d34b686aa8C04921397c5807DB9ECEdba00a4c');
            var MyContractC = web3.eth.contract(abiC);
            var contractInstanceC = MyContractC.at('0xc636e73Ff29fAEbCABA9E0C3f6833EaD179FFd5c');
            var MyContractR = web4.eth.contract(abiR);
            var contractInstanceR = MyContractR.at('0x7a1a8ac7796ed2e53ababfc547241f8c67b719a2');

            var stage = ['waiting for block 3,903,900', 'started', 'ended'];
            var stageNum = 0;
            var start = 3903900;
            var cap = web3.toBigNumber(-1);
            var capG = web3.toBigNumber(-1);
            var raised = web3.toBigNumber(-1);
            var raisedG = web3.toBigNumber(-1);
            var raisedT = web3.toBigNumber(-1);
            var curveM = web3.toBigNumber(-1);
            var currentCurve = web3.toBigNumber(-1);
            var curves = [[],[],[],[],[],[],[],[],[],[]];
            var ethusd = 0;
            var unconfirmed = web3.toBigNumber(-1);
            var unconfirmedeth = web3.toBigNumber(-1);

            function getSync() {
                $('#stage').html(stage[stageNum]);
                web3.eth.getBlockNumber(function(error, data) {
                    if (!error) {
                        $('#block').html(web3.toBigNumber(data).toFormat(0));
                        blink('#block');
                        if (data < start) {
                            $('#stageTime').countdown((start - data) * 16 * 1000 + new Date().getTime(), function(event) {
                                $(this).text(event.strftime('%H:%M:%S'));
                            });
                        } else {
                            $('#stageTime').html('');
                            if (stageNum === 0) {
                                stageNum = 1;
                                $('#stage').html(stage[stageNum]);
                            }
                        }
                    }
                });
                contractInstanceR.txs.call(function(error, data) {
                    if (!error) {
                        $('#unconfirmed').html(data.toNumber());
                        if (!unconfirmed.equals(data)) {
                            unconfirmed = data;
                            blink('#unconfirmed');
                        }
                    }
                });
                contractInstanceR.eth.call(function(error, data) {
                    if (!error) {
                        $('#unconfirmedeth').html(web3.fromWei(data,'ether').toFormat(2));
                        if (!unconfirmedeth.equals(data)) {
                            unconfirmedeth = data;
                            blink('#unconfirmedeth');
                        }
                    }
                });
                contractInstance.totalGuaranteedCollected.call(function(error, data) {
                    if (!error) {
                        $('#raisedG').html(web3.fromWei(data,'ether').toFormat(2));
                        if (!raisedG.equals(data)) {
                            raisedG = data;
                            blink('#raisedG');
                        }
                    }
                });
                contractInstance.totalNormalCollected.call(function(error, data) {
                    if (!error) {
                        $('#raised').html(web3.fromWei(data,'ether').toFormat(2));
                        if (!raised.equals(data)) {
                            raised = data;
                            blink('#raised');
                        }
                        contractInstanceC.toCollect.call(data, function(error, dataC) {
                            if (!error) {
                              $('#curveM').html(web3.fromWei(dataC,'ether').toFormat(2));
                              if (!curveM.equals(dataC)) {
                                  curveM = dataC;
                                  blink('#curveM');
                              }
                            }
                        });
                        if (curves[curves.length - 1].length > 0 && curves[curves.length - 1][0].lessThanOrEqual(raised)) {
                            stageNum = 2;
                            $('#stage').html(stage[stageNum]);
                        }
                    }
                });
                contractInstance.totalCollected.call(function(error, data) {
                    if (!error) {
                        $('#raisedT').html(web3.fromWei(data,'ether').toFormat(2));
                        if (!raisedT.equals(data)) {
                            raisedT = data;
                            blink('#raisedT');
                            $('#raisedD').html(web3.fromWei(data,'ether').times(ethusd).toFormat(2));
                            blink('#raisedD');
                        }
                    }
                });
                contractInstanceC.currentIndex.call(function(error, data) {
                    if (!error) {
                        $('#curve').html(web3.fromWei(data,'ether').toNumber());
                        if (!currentCurve.equals(data)) {
                            currentCurve = data;
                            blink('#curve');
                        }
                    }
                });
                for (var i = 0; i < curves.length; i++) {
                    if (curves[i].length === 0) {
                      (function(i) {
                          contractInstanceC.curves.call(i, function(error, data) {
                              if (!error) {
                                if (data[1].greaterThan(0)) {
                                    curves[i][0] = data[1];
                                    curves[i][1] = data[2];
                                    $('#cl' + i).html(web3.fromWei(data[1],'ether').toFormat(2));
                                    $('#cs' + i).html(data[2].toFormat(0));
                                    blink('#cl' + i);
                                    blink('#cs' + i);
                                }
                              }
                          });
                      }(i));
                    }
                }

            }
            getSync();
            getethusd();
            setInterval(function() {
                getSync();
            }, 15 * 1000);
            setInterval(function() {
                getethusd();
            }, 5 * 60 * 1000);
            function getethusd() {
              $.get('https://min-api.cryptocompare.com/data/price?fsym=ETH&tsyms=USD', function(data) {
                  ethusd = data.USD;
              });
            }
            function blink(id) {
                $(id).css('background-color', '#159957');
                setTimeout(function () {
                    $(id).css('background-color', 'white');
                }, 200);
            }
        });

    </script>
</head>

<body>
    <section class="page-header">
        <h1 class="project-name">(function(){})();</h1>
        <h2 class="project-tagline">Blockchain, make me rich and I care not what you can be used for.</h2>
        <a href="https://github.com/slacknation/medium/tree/master/018" class="btn">View on GitHub</a>
    </section>
    <section class="main-content">
        <h3><a id="welcome-to-github-pages" class="anchor" href="#welcome-to-github-pages" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span>
        </a>18. Status ICO</h3>
        <div>stage: <span style="color:#159957;font-size:20px;" id="stage">...</span> <span style="color:#E74C3C;font-size:20px;" id="stageTime">...</span></div>
        <div>current block: <span style="color:#159957;font-size:20px;" id="block">...</span></div>
        <div>raised (public): <span style="color:#159957;font-size:20px;" id="raised">...</span> ETH</div>
        <div>raised (guaranteed): <span style="color:#159957;font-size:20px;" id="raisedG">...</span> ETH of <span style="color:#159957;font-size:20px;">30,000</span> ETH cap</div>
        <div>total raised: <span style="color:#159957;font-size:20px;" id="raisedT">...</span> ETH ($ <span style="color:#159957;font-size:20px;" id="raisedD">...</span>)</div>
        <div>current curve: <span style="color:#159957;font-size:20px;" id="curve">...</span></div>
        <div>current max funding per tx: <span style="color:#159957;font-size:20px;" id="curveM">...</span> ETH = (limit - raised) / slope</div>
        <div>unconfirmed tx to ico: <span style="color:#159957;font-size:20px;" id="unconfirmed">...</span> txs, <span style="color:#159957;font-size:20px;" id="unconfirmedeth">...</span> ETH</div>
        <div>price: <span style="color:#159957;font-size:20px;">1</span> ETH for <span style="color:#159957;font-size:20px;">10,000</span> SNT</div>
        <br />
        <div>recommended gas: <span style="color:#159957;font-size:20px;">200000</span></div>
        <div>maximum gasPrice: <span style="color:#159957;font-size:20px;">50000000000</span> or <span style="color:#159957;font-size:20px;">50</span> gwei</div>
        <div>do not send from a contract</div>
        <div>use a new address for each try</div>
        <br />
        curves to limit funding per tx
        <table>
          <tr><th>curve</th><th>limit (eth)</th><th>slope</th></tr>
          <tr><td>0</td><td style="color:#159957;" id="cl0">?</td><td style="color:#159957;" id="cs0">?</td></tr>
          <tr><td>1</td><td style="color:#159957;" id="cl1">?</td><td style="color:#159957;" id="cs1">?</td></tr>
          <tr><td>2</td><td style="color:#159957;" id="cl2">?</td><td style="color:#159957;" id="cs2">?</td></tr>
          <tr><td>3</td><td style="color:#159957;" id="cl3">?</td><td style="color:#159957;" id="cs3">?</td></tr>
          <tr><td>4</td><td style="color:#159957;" id="cl4">?</td><td style="color:#159957;" id="cs4">?</td></tr>
          <tr><td>5</td><td style="color:#159957;" id="cl5">?</td><td style="color:#159957;" id="cs5">?</td></tr>
          <tr><td>6</td><td style="color:#159957;" id="cl6">?</td><td style="color:#159957;" id="cs6">?</td></tr>
          <tr><td>7</td><td style="color:#159957;" id="cl7">?</td><td style="color:#159957;" id="cs7">?</td></tr>
          <tr><td>8</td><td style="color:#159957;" id="cl8">?</td><td style="color:#159957;" id="cs8">?</td></tr>
          <tr><td>9</td><td style="color:#159957;" id="cl9">?</td><td style="color:#159957;" id="cs9">?</td></tr>
        </table>
        <br />
        <div>*data from infura.io and cryptocompare</div>
        <div>*data updated frequently</div>
        <footer class="site-footer">
            <span class="site-footer-owner">Maintained by <a href="https://github.com/slacknation/medium">slacknation</a> at gmail.com</span>
            <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
        </footer>
    </section>
    <script>
        (function(i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r;
            i[r] = i[r] || function() {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
            a = s.createElement(o),
                m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m)
        })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
        ga('create', 'UA-73445041-1', 'auto');
        ga('send', 'pageview');

    </script>
</body>

</html>
