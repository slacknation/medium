<!DOCTYPE html>
<html lang="en-us">

<head>
    <meta charset="UTF-8">
    <title>Charts and Data</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="../css/normalize.css" media="screen">
    <link rel="stylesheet" type="text/css" href="../css/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="../css/github-light.css" media="screen">
</head>

<body>
    <section class="page-header">
        <h1 class="project-name">(function(){})();</h1>
        <h2 class="project-tagline">Blockchain, make me rich and I care not what you can be used for.</h2>
        <a href="https://github.com/slacknation/medium/tree/master/019" class="btn">View on GitHub</a>
    </section>
    <section class="main-content">
        <h3><a id="welcome-to-github-pages" class="anchor" href="#welcome-to-github-pages" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span>
        </a>19. Bancor changer BNT/ETH</h3>
        <div>changer address: <span style="color:#159957;font-size:20px;" id="address">...</span></div>
        <div>current block: <span style="color:#159957;font-size:20px;" id="block">...</span></div>
        <div>BNT supply: <span style="color:#159957;font-size:20px;" id="bntS">...</span></div>
        <div>virtual ETH reserve: <span style="color:#159957;font-size:20px;" id="ethV">...</span></div>
        <div>ETH reserve: <span style="color:#159957;font-size:20px;" id="ethR">...</span></div>
        <div>reserve ratio: <span style="color:#159957;font-size:20px;" id="ratio">...</span></div>
        <div>floor reserve: <span style="color:#159957;font-size:20px;" id="floor">...</span></div>
        <br />
        <table>
          buy BNT
          <tr><th>BNT</th><th>ETH</th><th>BNT/ETH</th></tr>
          <tr><td style="color:#159957;" id="cl0">...</td><td id="cs0">...</td></td><td style="color:#159957;" id="cm0">...</td></tr>
          <tr><td style="color:#159957;" id="cl1">...</td><td id="cs1">...</td></td><td style="color:#159957;" id="cm1">...</td></tr>
          <tr><td style="color:#159957;" id="cl2">...</td><td id="cs2">...</td></td><td style="color:#159957;" id="cm2">...</td></tr>
          <tr><td style="color:#159957;" id="cl3">...</td><td id="cs3">...</td></td><td style="color:#159957;" id="cm3">...</td></tr>
          <tr><td style="color:#159957;" id="cl4">...</td><td id="cs4">...</td></td><td style="color:#159957;" id="cm4">...</td></tr>
        </table>
        <br />
        <table>
          sell BNT
          <tr><th>BNT</th><th>ETH</th><th>BNT/ETH</th></tr>
          <tr><td id="sl0">...</td><td style="color:#159957;" id="ss0">...</td></td><td style="color:#159957;" id="sm0">...</td></tr>
          <tr><td id="sl1">...</td><td style="color:#159957;" id="ss1">...</td></td><td style="color:#159957;" id="sm1">...</td></tr>
          <tr><td id="sl2">...</td><td style="color:#159957;" id="ss2">...</td></td><td style="color:#159957;" id="sm2">...</td></tr>
          <tr><td id="sl3">...</td><td style="color:#159957;" id="ss3">...</td></td><td style="color:#159957;" id="sm3">...</td></tr>
          <tr><td id="sl4">...</td><td style="color:#159957;" id="ss4">...</td></td><td style="color:#159957;" id="sm4">...</td></tr>
        </table>
        <br />
        <div>*data from infura.io</div>
        <div>*data updated frequently</div>
        <footer class="site-footer">
            <span class="site-footer-owner">Maintained by <a href="https://github.com/slacknation/medium">slacknation</a> at gmail.com</span>
            <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
        </footer>
    </section>
    <script src="../js/jquery.min.js"></script>
    <script src="../js/web3.min.js"></script>
    <script>
          $( document ).ready(function() {
            var color = ['#00A388', '#E74C3C', '#3498DB', '#FF851B'];
            var abi = [{"constant":true,"inputs":[{"name":"_reserveToken","type":"address"}],"name":"getReserveBalance","outputs":[{"name":"balance","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"_fromToken","type":"address"},{"name":"_toToken","type":"address"},{"name":"_amount","type":"uint256"}],"name":"getReturn","outputs":[{"name":"amount","type":"uint256"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_newOwner","type":"address"}],"name":"transferTokenOwnership","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"changerType","outputs":[{"name":"","type":"string"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"acceptTokenOwnership","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_token","type":"address"},{"name":"_to","type":"address"},{"name":"_amount","type":"uint256"}],"name":"withdrawFromToken","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_reserveToken","type":"address"},{"name":"_ratio","type":"uint8"},{"name":"_enableVirtualBalance","type":"bool"},{"name":"_virtualBalance","type":"uint256"}],"name":"updateReserve","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_to","type":"address"},{"name":"_amount","type":"uint256"}],"name":"issueTokens","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"formula","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"_tokenIndex","type":"uint16"}],"name":"changeableToken","outputs":[{"name":"tokenAddress","type":"address"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"version","outputs":[{"name":"","type":"string"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"changeableTokenCount","outputs":[{"name":"count","type":"uint16"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_token","type":"address"},{"name":"_to","type":"address"},{"name":"_amount","type":"uint256"}],"name":"withdrawTokens","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_fromToken","type":"address"},{"name":"_toToken","type":"address"},{"name":"_amount","type":"uint256"},{"name":"_minReturn","type":"uint256"}],"name":"change","outputs":[{"name":"amount","type":"uint256"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_reserveToken","type":"address"},{"name":"_sellAmount","type":"uint256"},{"name":"_minReturn","type":"uint256"}],"name":"sell","outputs":[{"name":"amount","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"_reserveToken","type":"address"},{"name":"_sellAmount","type":"uint256"}],"name":"getSaleReturn","outputs":[{"name":"amount","type":"uint256"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"acceptOwnership","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_disable","type":"bool"}],"name":"disableTokenTransfers","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"owner","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"reserveTokenCount","outputs":[{"name":"count","type":"uint16"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"_reserveToken","type":"address"},{"name":"_depositAmount","type":"uint256"}],"name":"getPurchaseReturn","outputs":[{"name":"amount","type":"uint256"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_reserveToken","type":"address"},{"name":"_depositAmount","type":"uint256"},{"name":"_minReturn","type":"uint256"}],"name":"buy","outputs":[{"name":"amount","type":"uint256"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_token","type":"address"},{"name":"_ratio","type":"uint8"},{"name":"_enableVirtualBalance","type":"bool"}],"name":"addReserve","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"reserveTokens","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_from","type":"address"},{"name":"_amount","type":"uint256"}],"name":"destroyTokens","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"newOwner","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"reserves","outputs":[{"name":"virtualBalance","type":"uint256"},{"name":"ratio","type":"uint8"},{"name":"isVirtualBalanceEnabled","type":"bool"},{"name":"isPurchaseEnabled","type":"bool"},{"name":"isSet","type":"bool"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_reserveToken","type":"address"},{"name":"_disable","type":"bool"}],"name":"disableReservePurchases","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_formula","type":"address"}],"name":"setFormula","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"token","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"inputs":[{"name":"_token","type":"address"},{"name":"_formula","type":"address"},{"name":"_reserveToken","type":"address"},{"name":"_reserveRatio","type":"uint8"}],"payable":false,"type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"name":"_fromToken","type":"address"},{"indexed":true,"name":"_toToken","type":"address"},{"indexed":true,"name":"_trader","type":"address"},{"indexed":false,"name":"_amount","type":"uint256"},{"indexed":false,"name":"_return","type":"uint256"}],"name":"Change","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"_prevOwner","type":"address"},{"indexed":false,"name":"_newOwner","type":"address"}],"name":"OwnerUpdate","type":"event"}];
            var abiE = [{"constant":true,"inputs":[],"name":"name","outputs":[{"name":"","type":"string"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_spender","type":"address"},{"name":"_value","type":"uint256"}],"name":"approve","outputs":[{"name":"success","type":"bool"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"totalSupply","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_from","type":"address"},{"name":"_to","type":"address"},{"name":"_value","type":"uint256"}],"name":"transferFrom","outputs":[{"name":"success","type":"bool"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_amount","type":"uint256"}],"name":"withdraw","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"decimals","outputs":[{"name":"","type":"uint8"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"standard","outputs":[{"name":"","type":"string"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_token","type":"address"},{"name":"_to","type":"address"},{"name":"_amount","type":"uint256"}],"name":"withdrawTokens","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"balanceOf","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"acceptOwnership","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"owner","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"symbol","outputs":[{"name":"","type":"string"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_to","type":"address"},{"name":"_value","type":"uint256"}],"name":"transfer","outputs":[{"name":"success","type":"bool"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"deposit","outputs":[],"payable":true,"type":"function"},{"constant":true,"inputs":[],"name":"newOwner","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"},{"name":"","type":"address"}],"name":"allowance","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"payable":false,"type":"function"},{"inputs":[],"payable":false,"type":"constructor"},{"payable":true,"type":"fallback"},{"anonymous":false,"inputs":[{"indexed":false,"name":"_amount","type":"uint256"}],"name":"Issuance","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"_amount","type":"uint256"}],"name":"Destruction","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"_prevOwner","type":"address"},{"indexed":false,"name":"_newOwner","type":"address"}],"name":"OwnerUpdate","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"_from","type":"address"},{"indexed":true,"name":"_to","type":"address"},{"indexed":false,"name":"_value","type":"uint256"}],"name":"Transfer","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"_owner","type":"address"},{"indexed":true,"name":"_spender","type":"address"},{"indexed":false,"name":"_value","type":"uint256"}],"name":"Approval","type":"event"}];

            var web3 = new Web3(new Web3.providers.HttpProvider('https://mainnet.infura.io/'));

            var MyContract = web3.eth.contract(abi);
            var changer = '0xCA83bD8c4C7B1c0409B25FbD7e70B1ef57629fF4';
            var changerInstance = MyContract.at(changer);

            var MyContract2 = web3.eth.contract(abiE);
            var ether = '0xD76b5c2A23ef78368d8E34288B5b65D616B746aE';
            var etherInstance = MyContract2.at(ether);

            var bnt = '0x1F573D6Fb3F13d689FF844B4cE37794d79a7FF1C';
            var bntInstance = MyContract2.at(bnt);

            var floor = '0x7Ec6A713197FCBb4cFe7213800470b0940268549';

            var buy = web3.toBigNumber(0);
            var sell = web3.toBigNumber(0);
            var bntS = web3.toBigNumber(0);
            var ethV = web3.toBigNumber(0);
            var ethR = web3.toBigNumber(0);
            var ratio = web3.toBigNumber(0);
            var floorR = web3.toBigNumber(0);
            var buyAmount = [1, 10, 100, 1000, 10000];
            var sellAmount = [100, 1000, 10000, 100000, 1000000];
            var storeBuy = [];
            var storeSell = [];
            for (var i = 0; i < buyAmount.length; i++) {
                $('#cs' + i).html(web3.toBigNumber(buyAmount[i]).toFormat(0));
                storeBuy.push(web3.toBigNumber(0));
            }
            for (var i = 0; i < sellAmount.length; i++) {
                $('#sl' + i).html(web3.toBigNumber(sellAmount[i]).toFormat(0));
                storeSell.push(web3.toBigNumber(0));
            }

            $('#address').html(changer);
            function getSync() {
                web3.eth.getBlockNumber(function(error, data) {
                    if (!error) {
                        $('#block').html(web3.toBigNumber(data).toFormat(0));
                        blink('#block');
                    }
                });
                web3.eth.getBalance(floor, function(error, data) {
                    if (!error) {
                      $('#floor').html(web3.toBigNumber(web3.fromWei(data, 'ether')).toFormat(2));
                      if (!floorR.equals(data)) {
                          floorR = data;
                          blink('#floor');
                      }
                    }
                });
                bntInstance.totalSupply.call(function(error, data) {
                    if (!error) {
                      $('#bntS').html(web3.toBigNumber(web3.fromWei(data, 'ether')).toFormat(2));
                      if (!bntS.equals(data)) {
                          bntS = data;
                          blink('#bntS');
                      }
                    }
                });
                etherInstance.balanceOf.call(changer, function(error, data) {
                    if (!error) {
                      $('#ethR').html(web3.toBigNumber(web3.fromWei(data, 'ether')).toFormat(2));
                      if (!ethR.equals(data)) {
                          ethR = data;
                          blink('#ethR');
                      }
                    }
                });
                changerInstance.reserves.call(ether, function(error, data) {
                    if (!error) {
                      $('#ethV').html(web3.toBigNumber(web3.fromWei(data[0], 'ether')).toFormat(2));
                      $('#ratio').html((data[1]).toNumber());
                      if (!ethV.equals(data[0])) {
                          ethV = data[0];
                          blink('#ethV');
                      }
                      if (!ratio.equals(data[1])) {
                          ratio = data[1];
                          blink('#ratio');
                      }
                    }
                });
                for (var i = 0; i < buyAmount.length; i++) {
                    (function(i) {
                        changerInstance.getPurchaseReturn.call(ether, web3.toWei(buyAmount[i], 'ether'), function(error, data) {
                            if (!error) {
                              $('#cl' + i).html(web3.toBigNumber(web3.fromWei(data, 'ether')).toFormat(2));
                              $('#cm' + i).html(web3.toBigNumber(buyAmount[i]).dividedBy(web3.fromWei(data, 'ether')).toFormat(6));
                              if (!storeBuy[i].equals(data)) {
                                  storeBuy[i] = data;
                                  blink('#cl' + i);
                                  blink('#cm' + i);
                              }
                            }
                        });
                    }(i));
                }
                for (var i = 0; i < sellAmount.length; i++) {
                    (function(i) {
                        changerInstance.getSaleReturn.call(ether, web3.toWei(sellAmount[i], 'ether'), function(error, data) {
                            if (!error) {
                              $('#ss' + i).html(web3.toBigNumber(web3.fromWei(data, 'ether')).toFormat(2));
                              $('#sm' + i).html(web3.toBigNumber(web3.fromWei(data, 'ether')).dividedBy(sellAmount[i]).toFormat(6));
                              if (!storeSell[i].equals(data)) {
                                  storeSell[i] = data;
                                  blink('#ss' + i);
                                  blink('#sm' + i);
                              }
                            }
                        });
                    }(i));
                }
            }
            getSync();
            setInterval(function() {
                getSync();
            }, 30 * 1000);
            function blink(id) {
                $(id).css('background-color', '#159957');
                setTimeout(function () {
                    $(id).css('background-color', 'white');
                }, 200);
            }
        });

    </script>
    <script>
        (function(i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r;
            i[r] = i[r] || function() {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
            a = s.createElement(o),
                m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m)
        })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
        ga('create', 'UA-73445041-1', 'auto');
        ga('send', 'pageview');

    </script>
</body>

</html>
